<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hbsd.mapper.business.TbMeetingMapper">
  <resultMap id="BaseResultMap" type="com.hbsd.bean.business.TbMeeting">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="meeting_create_time" jdbcType="TIMESTAMP" property="meetingCreateTime" />
    <result column="meeting_type" jdbcType="TINYINT" property="meetingType" />
    <result column="meeting_user_id" jdbcType="INTEGER" property="meetingUserId" />
    <result column="meeting_status" jdbcType="TINYINT" property="meetingStatus" />
    <result column="meeting_file" jdbcType="VARCHAR" property="meetingFile" />
    <result column="meeting_name" jdbcType="VARCHAR" property="meetingName" />
    <result column="typeName" jdbcType="VARCHAR" property="typeName" />
    <result column="meeting_address" jdbcType="VARCHAR" property="tbMeetingAddress" />
    <result column="meeting_problem" jdbcType="LONGVARCHAR" property="tbMeetingProblem" />
    <result column="meeting_host" jdbcType="VARCHAR" property="tbMeetingHost" />
    <result column="meeting_recorder" jdbcType="VARCHAR" property="tbMeetingRecorder" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.hbsd.bean.business.TbMeeting">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="meeting_context" jdbcType="LONGVARCHAR" property="meetingContext" />
  </resultMap>


  <!--会议和参会人员的嵌套查询-->
  <resultMap id="BaseResultMap2" type="com.hbsd.bean.business.TbMeeting" extends="ResultMapWithBLOBs">

      <collection property="tbMeetingUser" ofType="com.hbsd.bean.business.TbMeetingUser">
        <id column="subid" jdbcType="INTEGER" property="id" />
        <result column="meeting_id" jdbcType="INTEGER" property="meetingId" />
        <result column="user_id" jdbcType="INTEGER" property="userId" />
        <result column="userName" jdbcType="VARCHAR" property="userName" />
      </collection>

  </resultMap>


  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, meeting_create_time, meeting_type, meeting_user_id, meeting_status, meeting_file,meeting_address,
    meeting_problem,meeting_host,meeting_recorder,meeting_name
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    meeting_context
  </sql>

  <sql id="Meeting_User_List">
    tb_meeting.id,
    meeting_name,
    meeting_create_time,
    meeting_type,
    meeting_user_id,
    meeting_status,
    meeting_file,
    meeting_context,
    meeting_address,
    meeting_problem,
    meeting_host,
    meeting_recorder,
    tb_meeting_user.id as subid,
    tb_meeting_user.meeting_id,
    tb_meeting_user.user_id,
    sys_user.nickName as userName,
    sys_dict_value.data_value as typeName
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from tb_meeting
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from tb_meeting
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.hbsd.bean.business.TbMeeting">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into tb_meeting (id, meeting_create_time, meeting_type,
      meeting_user_id, meeting_status, meeting_file,
      meeting_context)
    values (#{id,jdbcType=INTEGER}, #{meetingCreateTime,jdbcType=TIMESTAMP}, #{meetingType,jdbcType=TINYINT},
      #{meetingUserId,jdbcType=INTEGER}, #{meetingStatus,jdbcType=TINYINT}, #{meetingFile,jdbcType=VARCHAR},
      #{meetingContext,jdbcType=LONGVARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.hbsd.bean.business.TbMeeting">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into tb_meeting
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="meetingCreateTime != null">
        meeting_create_time,
      </if>
      <if test="tbMeetingAddress != null">
        meeting_address,
      </if>
      <if test="meetingType != null">
        meeting_type,
      </if>
      <if test="meetingUserId != null">
        meeting_user_id,
      </if>
      <if test="meetingStatus != null">
        meeting_status,
      </if>
      <if test="meetingFile != null">
        meeting_file,
      </if>
      <if test="meetingContext != null">
        meeting_context,
      </if>
      <if test="meetingName != null">
        meeting_name,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="meetingCreateTime != null">
        #{meetingCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="meetingType != null">
        #{meetingType,jdbcType=TINYINT},
      </if>
      <if test="meetingUserId != null">
        #{meetingUserId,jdbcType=INTEGER},
      </if>
      <if test="meetingStatus != null">
        #{meetingStatus,jdbcType=TINYINT},
      </if>
      <if test="meetingFile != null">
        #{meetingFile,jdbcType=VARCHAR},
      </if>
      <if test="meetingContext != null">
        #{meetingContext,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.hbsd.bean.business.TbMeeting">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_meeting
    <set>
      <if test="meetingCreateTime != null">
        meeting_create_time = #{meetingCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="meetingType != null">
        meeting_type = #{meetingType,jdbcType=TINYINT},
      </if>
      <if test="meetingUserId != null">
        meeting_user_id = #{meetingUserId,jdbcType=INTEGER},
      </if>
      <if test="meetingStatus != null">
        meeting_status = #{meetingStatus,jdbcType=TINYINT},
      </if>
      <if test="meetingFile != null">
        meeting_file = #{meetingFile,jdbcType=VARCHAR},
      </if>
      <if test="meetingContext != null">
        meeting_context = #{meetingContext,jdbcType=LONGVARCHAR},
      </if>
      <if test="meetingName != null">
        meeting_name = #{meetingName,jdbcType=VARCHAR},
      </if>
      <if test="tbMeetingAddress != null">
        meeting_address = #{tbMeetingAddress,jdbcType=VARCHAR},
      </if>
      <if test="tbMeetingProblem != null">
        meeting_problem = #{tbMeetingProblem,jdbcType=LONGVARCHAR},
      </if>
      <if test="tbMeetingHost != null">
        meeting_host = #{tbMeetingHost,jdbcType=VARCHAR},
      </if>
      <if test="tbMeetingRecorder != null">
        meeting_recorder = #{tbMeetingRecorder,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.hbsd.bean.business.TbMeeting">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_meeting
    set meeting_create_time = #{meetingCreateTime,jdbcType=TIMESTAMP},
      meeting_type = #{meetingType,jdbcType=TINYINT},
      meeting_user_id = #{meetingUserId,jdbcType=INTEGER},
      meeting_status = #{meetingStatus,jdbcType=TINYINT},
      meeting_file = #{meetingFile,jdbcType=VARCHAR},
      meeting_context = #{meetingContext,jdbcType=LONGVARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hbsd.bean.business.TbMeeting">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_meeting
    set meeting_create_time = #{meetingCreateTime,jdbcType=TIMESTAMP},
      meeting_type = #{meetingType,jdbcType=TINYINT},
      meeting_user_id = #{meetingUserId,jdbcType=INTEGER},
      meeting_status = #{meetingStatus,jdbcType=TINYINT},
      meeting_file = #{meetingFile,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="selectList" resultMap="BaseResultMap2">
    select
    <include refid="Meeting_User_List" />
    from tb_meeting
    LEFT  JOIN tb_meeting_user ON tb_meeting.id=tb_meeting_user.meeting_id
    LEFT  JOIN sys_user on tb_meeting_user.user_id = sys_user.id
    LEFT  JOIN sys_dict_value on tb_meeting.meeting_type=sys_dict_value.id where sys_dict_value.dict_id=31
      <if test="keyword != null and keyword !=''">
          and tb_meeting.meeting_name LIKE concat('%',#{keyword},'%')
      </if>
    ORDER by meeting_create_time DESC;
   <!--  <if test="model.pager.orderCondition != null and model.pager.orderCondition != ''">
          ${model.pager.orderCondition}
      </if>

      <if test="model.pager.mysqlQueryCondition != null and model.pager.mysqlQueryCondition != ''">
          ${model.pager.mysqlQueryCondition}
      </if>-->



  </select>

  <insert id="saveMeeting" keyColumn="id" keyProperty="id" useGeneratedKeys="true">
    INSERT INTO tb_meeting (
	meeting_create_time,
	meeting_type,
	meeting_user_id,
	meeting_context,
	meeting_status,
	meeting_file,
	meeting_name,
	meeting_address,
	meeting_problem,
	meeting_host,
	meeting_recorder
)
VALUES
	(
		#{meetingCreateTime},
		#{meetingType},
		#{meetingUserId},
		#{meetingContext},
		#{meetingStatus},
		#{meetingFile},
		#{meetingName},
		#{tbMeetingAddress},
		#{tbMeetingProblem},
		#{tbMeetingHost},
	    #{tbMeetingRecorder}
	);

  </insert>


    <select id="queryCount" resultType="java.lang.Integer">
        select count(1) from tb_meeting
        where 1=1
      <if test="keyword != null and keyword !=''">
        and tb_meeting.meeting_name LIKE concat('%',#{keyword},'%')
      </if>
    </select>

</mapper>